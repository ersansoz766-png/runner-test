name: token-check-fixed
on: workflow_dispatch
jobs:
  test:
    runs-on: [self-hosted, Windows, X64]
    permissions:
      contents: read
      issues: write
    steps:
      - name: Check Token with Context
        env:
          MY_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        shell: cmd
        run: |
          echo Checking token from secrets context...
          if defined MY_TOKEN (
            echo Token EXISTS via secrets.GITHUB_TOKEN
            echo First 10 chars:
            echo %MY_TOKEN:~0,10%
          ) else (
            echo Token still NOT FOUND
          )
          
          echo.
          echo Testing API with token:
          curl -H "Authorization: Bearer %MY_TOKEN%" https://api.github.com/user
